<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test Client</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #log {
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: scroll;
            background: #f9f9f9;
        }

        .sent {
            color: blue;
        }

        .received {
            color: green;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <h1>WebSocket Test Client</h1>
    <p>Target: <code>ws://localhost:8080/transcribe</code></p>
    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn" disabled>Disconnect</button>
    <div id="status">Status: Disconnected</div>
    <br>
    <div id="log"></div>

    <script>
        const WS_URL = 'ws://localhost:8080/transcribe';
        const INTERVAL_MS = 500;
        let ws;
        let intervalId;
        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            if (type) div.className = type;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        connectBtn.onclick = () => {
            log(`Connecting to ${WS_URL}...`);
            ws = new WebSocket(WS_URL);

            ws.onopen = () => {
                statusDiv.textContent = 'Status: Connected';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                log('Connected to WebSocket server', 'success');

                // Send dummy audio data periodically
                intervalId = setInterval(() => {
                    if (ws.readyState === WebSocket.OPEN) {
                        // Create a dummy Uint8Array (simulating audio chunk)
                        const audioChunk = new Uint8Array(1024);
                        ws.send(audioChunk);
                        log(`Sent ${audioChunk.length} bytes of audio data`, 'sent');
                    }
                }, INTERVAL_MS);
            };

            ws.onmessage = (event) => {
                log('Received message: ' + event.data, 'received');
            };

            ws.onerror = (error) => {
                log('WebSocket error observed', 'error');
                statusDiv.textContent = 'Status: Error';
            };

            ws.onclose = (event) => {
                log(`Disconnected (Code: ${event.code}, Reason: ${event.reason})`, 'info');
                statusDiv.textContent = 'Status: Disconnected';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                clearInterval(intervalId);
            };
        };

        disconnectBtn.onclick = () => {
            if (ws) ws.close();
        };
    </script>
</body>

</html>